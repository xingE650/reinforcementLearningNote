<!DOCTYPE html>



  


<html class="theme-next gemini use-motion" lang="zh-CN">
<head><meta name="generator" content="Hexo 3.8.0">
  <meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
<meta name="theme-color" content="#222">









<meta http-equiv="Cache-Control" content="no-transform">
<meta http-equiv="Cache-Control" content="no-siteapp">
















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css">







<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css">

<link href="/css/main.css?v=5.1.4" rel="stylesheet" type="text/css">


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=5.1.4">


  <link rel="mask-icon" href="/images/logo.svg?v=5.1.4" color="#222">





  <meta name="keywords" content="Reinforcement Learning Jupyter Notebook,">










<meta name="description" content="引用来自ShangtongZhang的代码chapter01/tic_tac_toe.py Tic-Tac-Toe的python代码实现 1、引入模块并定义井字棋的常量">
<meta name="keywords" content="Reinforcement Learning Jupyter Notebook">
<meta property="og:type" content="article">
<meta property="og:title" content="Chapter01 Tic-Tac-Toe">
<meta property="og:url" content="http://yoursite.com/2018/11/14/Chapter01-Tic-Tac-Toe/index.html">
<meta property="og:site_name" content="Oppai&gt;&#x2F;&#x2F;&#x2F;&lt;">
<meta property="og:description" content="引用来自ShangtongZhang的代码chapter01/tic_tac_toe.py Tic-Tac-Toe的python代码实现 1、引入模块并定义井字棋的常量">
<meta property="og:locale" content="zh-CN">
<meta property="og:image" content="https://wx3.sinaimg.cn/large/0070VybLly1fx7to20tg5j30al07c3yo.jpg">
<meta property="og:updated_time" content="2018-12-15T01:29:50.984Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Chapter01 Tic-Tac-Toe">
<meta name="twitter:description" content="引用来自ShangtongZhang的代码chapter01/tic_tac_toe.py Tic-Tac-Toe的python代码实现 1、引入模块并定义井字棋的常量">
<meta name="twitter:image" content="https://wx3.sinaimg.cn/large/0070VybLly1fx7to20tg5j30al07c3yo.jpg">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Gemini',
    version: '5.1.4',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":true,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: '0',
      author: 'Author'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://yoursite.com/2018/11/14/Chapter01-Tic-Tac-Toe/">





  <title>Chapter01 Tic-Tac-Toe | Oppai>///<</title>
  








</head>

<body itemscope="" itemtype="http://schema.org/WebPage" lang="zh-CN">

  
  
    
  

  <div class="container sidebar-position-left page-post-detail">
    <div class="headband"></div>

    <header id="header" class="header" itemscope="" itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">Oppai>///<</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle"></p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br>
            
            Home
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br>
            
            Tags
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br>
            
            Archives
          </a>
        </li>
      

      
        <li class="menu-item menu-item-search">
          
            <a href="javascript:;" class="popup-trigger">
          
            
              <i class="menu-item-icon fa fa-search fa-fw"></i> <br>
            
            Search
          </a>
        </li>
      
    </ul>
  

  
    <div class="site-search">
      
  <div class="popup search-popup local-search-popup">
  <div class="local-search-header clearfix">
    <span class="search-icon">
      <i class="fa fa-search"></i>
    </span>
    <span class="popup-btn-close">
      <i class="fa fa-times-circle"></i>
    </span>
    <div class="local-search-input-wrapper">
      <input autocomplete="off" placeholder="Searching..." spellcheck="false" type="text" id="local-search-input">
    </div>
  </div>
  <div id="local-search-result"></div>
</div>



    </div>
  
</nav>


<!-- 图片轮播js文件cdn -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-backstretch/2.0.4/jquery.backstretch.min.js"></script>

<!-- 自定义的js文件 -->
<script type="text/javascript" src="/js/src/custom.js"></script>


 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/11/14/Chapter01-Tic-Tac-Toe/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="xingE650">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="https://wx2.sinaimg.cn/large/0070VybLly1fxoqylcs4uj309708rgoa.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Oppai>///<">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">Chapter01 Tic-Tac-Toe</h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2018-11-14T17:28:04+08:00">
                2018-11-14
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        <p>引用来自<a href="https://github.com/ShangtongZhang/reinforcement-learning-an-introduction" target="_blank" rel="noopener">ShangtongZhang</a>的代码<a href="https://github.com/ShangtongZhang/reinforcement-learning-an-introduction/tree/master/chapter01/tic_tac_toe.py" target="_blank" rel="noopener">chapter01/tic_tac_toe.py</a></p>
<p>Tic-Tac-Toe的python代码实现</p>
<h2 id="1、引入模块并定义井字棋的常量"><a href="#1、引入模块并定义井字棋的常量" class="headerlink" title="1、引入模块并定义井字棋的常量"></a>1、引入模块并定义井字棋的常量</h2><a id="more"></a>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"><span class="keyword">import</span> pickle</span><br><span class="line"><span class="keyword">import</span> matplotlib.pyplot <span class="keyword">as</span> plt</span><br><span class="line">%matplotlib inline</span><br><span class="line"><span class="comment"># 将rows和cols调至4，这种算法计算量就会大很多</span></span><br><span class="line">BOARD_ROWS = <span class="number">3</span></span><br><span class="line">BOARD_COLS = <span class="number">3</span></span><br><span class="line">BOARD_SIZE = BOARD_ROWS * BOARD_COLS</span><br></pre></td></tr></table></figure>
<h2 id="2、创建环境，State类，表征棋盘上的X和O子的情况。"><a href="#2、创建环境，State类，表征棋盘上的X和O子的情况。" class="headerlink" title="2、创建环境，State类，表征棋盘上的X和O子的情况。"></a>2、创建环境，State类，表征棋盘上的X和O子的情况。</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">State</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="comment"># the board is represented by an n * n array,</span></span><br><span class="line">        <span class="comment"># 1 represents a chessman of the player who moves first,</span></span><br><span class="line">        <span class="comment"># -1 represents a chessman of another player</span></span><br><span class="line">        <span class="comment"># 0 represents an empty position</span></span><br><span class="line">        self.data = np.zeros((BOARD_ROWS, BOARD_COLS))</span><br><span class="line">        self.winner = <span class="keyword">None</span></span><br><span class="line">        self.hash_val = <span class="keyword">None</span></span><br><span class="line">        self.end = <span class="keyword">None</span></span><br><span class="line">    <span class="comment"># compute the hash value for one state, it only work at first time</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">hash</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">if</span> self.hash_val <span class="keyword">is</span> <span class="keyword">None</span>:</span><br><span class="line">            self.hash_val = <span class="number">0</span></span><br><span class="line">            <span class="keyword">for</span> i <span class="keyword">in</span> self.data.reshape(BOARD_ROWS * BOARD_COLS):</span><br><span class="line">                <span class="keyword">if</span> i == <span class="number">-1</span>:</span><br><span class="line">                    <span class="comment"># shallow copy                     </span></span><br><span class="line">                    i = <span class="number">2</span></span><br><span class="line">                self.hash_val = self.hash_val * <span class="number">3</span> + i</span><br><span class="line">        <span class="keyword">return</span> int(self.hash_val)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># check whether a player has won the game, or it's a tie</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">is_end</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">if</span> self.end <span class="keyword">is</span> <span class="keyword">not</span> <span class="keyword">None</span>:</span><br><span class="line">            <span class="keyword">return</span> self.end</span><br><span class="line">        results = []</span><br><span class="line">        <span class="comment"># check row</span></span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">0</span>, BOARD_ROWS):</span><br><span class="line">            results.append(np.sum(self.data[i, :]))</span><br><span class="line">        <span class="comment"># check columns</span></span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">0</span>, BOARD_COLS):</span><br><span class="line">            results.append(np.sum(self.data[:, i]))</span><br><span class="line"></span><br><span class="line">        <span class="comment"># check diagonals</span></span><br><span class="line">        results.append(<span class="number">0</span>)</span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">0</span>, BOARD_ROWS):</span><br><span class="line">            results[<span class="number">-1</span>] += self.data[i, i]</span><br><span class="line">        results.append(<span class="number">0</span>)</span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">0</span>, BOARD_ROWS):</span><br><span class="line">            results[<span class="number">-1</span>] += self.data[i, BOARD_ROWS - <span class="number">1</span> - i]</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> result <span class="keyword">in</span> results:</span><br><span class="line">            <span class="keyword">if</span> result == <span class="number">3</span>:</span><br><span class="line">                self.winner = <span class="number">1</span></span><br><span class="line">                self.end = <span class="keyword">True</span></span><br><span class="line">                <span class="keyword">return</span> self.end</span><br><span class="line">            <span class="keyword">if</span> result == <span class="number">-3</span>:</span><br><span class="line">                self.winner = <span class="number">-1</span></span><br><span class="line">                self.end = <span class="keyword">True</span></span><br><span class="line">                <span class="keyword">return</span> self.end</span><br><span class="line"></span><br><span class="line">        <span class="comment"># whether it's a tie: no one wins, all places are filled.</span></span><br><span class="line">        sum = np.sum(np.abs(self.data))</span><br><span class="line">        <span class="keyword">if</span> sum == BOARD_ROWS * BOARD_COLS:</span><br><span class="line">            self.winner = <span class="number">0</span></span><br><span class="line">            self.end = <span class="keyword">True</span></span><br><span class="line">            <span class="keyword">return</span> self.end</span><br><span class="line"></span><br><span class="line">        <span class="comment"># game is still going on</span></span><br><span class="line">        self.end = <span class="keyword">False</span></span><br><span class="line">        <span class="keyword">return</span> self.end</span><br><span class="line"></span><br><span class="line">    <span class="comment"># @symbol: 1 or -1</span></span><br><span class="line">    <span class="comment"># put chessman symbol in position (i, j)</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">next_state</span><span class="params">(self, i, j, symbol)</span>:</span></span><br><span class="line">        new_state = State()</span><br><span class="line">        <span class="comment"># deep copy new_state.data</span></span><br><span class="line">        new_state.data = np.copy(self.data)</span><br><span class="line">        new_state.data[i, j] = symbol</span><br><span class="line">        <span class="keyword">return</span> new_state</span><br><span class="line"></span><br><span class="line">    <span class="comment"># print the board</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">print</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">0</span>, BOARD_ROWS):</span><br><span class="line">            print(<span class="string">'-------------'</span>)</span><br><span class="line">            out = <span class="string">'| '</span></span><br><span class="line">            <span class="keyword">for</span> j <span class="keyword">in</span> range(<span class="number">0</span>, BOARD_COLS):</span><br><span class="line">                <span class="keyword">if</span> self.data[i, j] == <span class="number">1</span>:</span><br><span class="line">                    token = <span class="string">'*'</span></span><br><span class="line">                <span class="keyword">if</span> self.data[i, j] == <span class="number">0</span>:</span><br><span class="line">                    token = <span class="string">'0'</span></span><br><span class="line">                <span class="keyword">if</span> self.data[i, j] == <span class="number">-1</span>:</span><br><span class="line">                    token = <span class="string">'x'</span></span><br><span class="line">                out += token + <span class="string">' | '</span></span><br><span class="line">            print(out)</span><br><span class="line">        print(<span class="string">'-------------'</span>)</span><br></pre></td></tr></table></figure>
<h3 id="关于这里的hash函数，是为了得到不重复的所有棋盘情况。但是为什么可以通过这种算法那？"><a href="#关于这里的hash函数，是为了得到不重复的所有棋盘情况。但是为什么可以通过这种算法那？" class="headerlink" title="关于这里的hash函数，是为了得到不重复的所有棋盘情况。但是为什么可以通过这种算法那？"></a>关于这里的hash函数，是为了得到不重复的所有棋盘情况。但是为什么可以通过这种算法那？</h3><h4 id="假设两个不同的棋盘情况A和B，他们的hash值是一致的，我们不妨设他们的最高位不相同，那么我们看到，该位最少相差1，通过等比数列求和可以得到，3-n-1-gt-2-1-3-1-3-2-…-3-n-，即最高位不同是无法通过其余位来弥补的，那么可见他们的最高位不同是不可能hash值相同的，以此递推，则可得A和B值是一样，即一样的棋盘，假设不成立。"><a href="#假设两个不同的棋盘情况A和B，他们的hash值是一致的，我们不妨设他们的最高位不相同，那么我们看到，该位最少相差1，通过等比数列求和可以得到，3-n-1-gt-2-1-3-1-3-2-…-3-n-，即最高位不同是无法通过其余位来弥补的，那么可见他们的最高位不同是不可能hash值相同的，以此递推，则可得A和B值是一样，即一样的棋盘，假设不成立。" class="headerlink" title="假设两个不同的棋盘情况A和B，他们的hash值是一致的，我们不妨设他们的最高位不相同，那么我们看到，该位最少相差1，通过等比数列求和可以得到，3^(n+1)&gt;2*(1+3^1+3^2+…+3^n)，即最高位不同是无法通过其余位来弥补的，那么可见他们的最高位不同是不可能hash值相同的，以此递推，则可得A和B值是一样，即一样的棋盘，假设不成立。"></a>假设两个不同的棋盘情况A和B，他们的hash值是一致的，我们不妨设他们的最高位不相同，那么我们看到，该位最少相差1，通过等比数列求和可以得到，3^(n+1)&gt;2*(1+3^1+3^2+…+3^n)，即最高位不同是无法通过其余位来弥补的，那么可见他们的最高位不同是不可能hash值相同的，以此递推，则可得A和B值是一样，即一样的棋盘，假设不成立。</h4><h2 id="3、公共函数，用来获取当前state。"><a href="#3、公共函数，用来获取当前state。" class="headerlink" title="3、公共函数，用来获取当前state。"></a>3、公共函数，用来获取当前state。</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_all_states_impl</span><span class="params">(current_state, current_symbol, all_states)</span>:</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">0</span>, BOARD_ROWS):</span><br><span class="line">        <span class="keyword">for</span> j <span class="keyword">in</span> range(<span class="number">0</span>, BOARD_COLS):</span><br><span class="line">            <span class="keyword">if</span> current_state.data[i][j] == <span class="number">0</span>:</span><br><span class="line">                newState = current_state.next_state(i, j, current_symbol)</span><br><span class="line">                newHash = newState.hash()</span><br><span class="line">                <span class="keyword">if</span> newHash <span class="keyword">not</span> <span class="keyword">in</span> all_states.keys():</span><br><span class="line">                    isEnd = newState.is_end()</span><br><span class="line">                    all_states[newHash] = (newState, isEnd)</span><br><span class="line">                    <span class="keyword">if</span> <span class="keyword">not</span> isEnd:</span><br><span class="line">                        get_all_states_impl(newState, -current_symbol, all_states)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_all_states</span><span class="params">()</span>:</span></span><br><span class="line">    current_symbol = <span class="number">1</span></span><br><span class="line">    current_state = State()</span><br><span class="line">    all_states = dict()</span><br><span class="line">    all_states[current_state.hash()] = (current_state, current_state.is_end())</span><br><span class="line">    get_all_states_impl(current_state, current_symbol, all_states)</span><br><span class="line">    <span class="keyword">return</span> all_states</span><br><span class="line"></span><br><span class="line"><span class="comment"># all possible board configurations</span></span><br><span class="line">all_states = get_all_states()</span><br><span class="line"><span class="comment"># for i in all_states.values():</span></span><br><span class="line"><span class="comment">#     i[0].print()</span></span><br><span class="line"><span class="comment">#     print(i[1])</span></span><br></pre></td></tr></table></figure>
<h2 id="4、Player类，用来模拟AI选手下棋的行为，得到value-function"><a href="#4、Player类，用来模拟AI选手下棋的行为，得到value-function" class="headerlink" title="4、Player类，用来模拟AI选手下棋的行为，得到value function"></a>4、Player类，用来模拟AI选手下棋的行为，得到value function</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># AI player</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Player</span>:</span></span><br><span class="line">    <span class="comment"># @step_size: the step size to update estimations</span></span><br><span class="line">    <span class="comment"># @epsilon: the probability to explore</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, step_size=<span class="number">0.1</span>, epsilon=<span class="number">0.1</span>)</span>:</span></span><br><span class="line">        self.estimations = dict()</span><br><span class="line">        self.step_size = step_size</span><br><span class="line">        self.epsilon = epsilon</span><br><span class="line">        self.states = []</span><br><span class="line">        <span class="comment"># greedy means that state is caused by exploiting, otherwise is caused by exploring</span></span><br><span class="line">        self.greedy = []</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">reset</span><span class="params">(self)</span>:</span></span><br><span class="line">        self.states = []</span><br><span class="line">        self.greedy = []</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">set_state</span><span class="params">(self, state)</span>:</span></span><br><span class="line">        self.states.append(state)</span><br><span class="line">        self.greedy.append(<span class="keyword">True</span>)</span><br><span class="line">        </span><br><span class="line">    <span class="comment"># give the player symbol,and update the value table</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">set_symbol</span><span class="params">(self, symbol)</span>:</span></span><br><span class="line">        self.symbol = symbol</span><br><span class="line">        <span class="keyword">for</span> hash_val <span class="keyword">in</span> all_states.keys():</span><br><span class="line">            (state, is_end) = all_states[hash_val]</span><br><span class="line">            <span class="keyword">if</span> is_end:</span><br><span class="line">                <span class="keyword">if</span> state.winner == self.symbol:</span><br><span class="line">                    self.estimations[hash_val] = <span class="number">1.0</span></span><br><span class="line">                <span class="keyword">elif</span> state.winner == <span class="number">0</span>:</span><br><span class="line">                    <span class="comment"># we need to distinguish between a tie and a lose</span></span><br><span class="line">                    self.estimations[hash_val] = <span class="number">0.5</span></span><br><span class="line">                <span class="keyword">else</span>:</span><br><span class="line">                    self.estimations[hash_val] = <span class="number">0</span></span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                self.estimations[hash_val] = <span class="number">0.5</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># update value estimation</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">backup</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="comment"># for debug</span></span><br><span class="line">        <span class="comment"># print('player trajectory')</span></span><br><span class="line">        <span class="comment"># for state in self.states:</span></span><br><span class="line">        <span class="comment">#     state.print()</span></span><br><span class="line"></span><br><span class="line">        self.states = [state.hash() <span class="keyword">for</span> state <span class="keyword">in</span> self.states]</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> reversed(range(len(self.states) - <span class="number">1</span>)):</span><br><span class="line">            state = self.states[i]</span><br><span class="line">            <span class="comment"># only udpate the state caused by exploiting </span></span><br><span class="line">            td_error = self.greedy[i] * (self.estimations[self.states[i + <span class="number">1</span>]] - self.estimations[state])</span><br><span class="line">            self.estimations[state] += self.step_size * td_error</span><br><span class="line"></span><br><span class="line">    <span class="comment"># choose an action based on the state</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">act</span><span class="params">(self)</span>:</span></span><br><span class="line">        state = self.states[<span class="number">-1</span>]</span><br><span class="line">        next_states = []</span><br><span class="line">        next_positions = []</span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> range(BOARD_ROWS):</span><br><span class="line">            <span class="keyword">for</span> j <span class="keyword">in</span> range(BOARD_COLS):</span><br><span class="line">                <span class="keyword">if</span> state.data[i, j] == <span class="number">0</span>:</span><br><span class="line">                    next_positions.append([i, j])</span><br><span class="line">                    next_states.append(state.next_state(i, j, self.symbol).hash())</span><br><span class="line">        <span class="comment"># explore</span></span><br><span class="line">        <span class="keyword">if</span> np.random.rand() &lt; self.epsilon:</span><br><span class="line">            action = next_positions[np.random.randint(len(next_positions))]</span><br><span class="line">            action.append(self.symbol)</span><br><span class="line">            self.greedy[<span class="number">-1</span>] = <span class="keyword">False</span></span><br><span class="line">            <span class="keyword">return</span> action</span><br><span class="line">        <span class="comment"># exploit</span></span><br><span class="line">        values = []</span><br><span class="line">        <span class="keyword">for</span> hash, pos <span class="keyword">in</span> zip(next_states, next_positions):</span><br><span class="line">            values.append((self.estimations[hash], pos))</span><br><span class="line">        np.random.shuffle(values)</span><br><span class="line">        values.sort(key=<span class="keyword">lambda</span> x: x[<span class="number">0</span>], reverse=<span class="keyword">True</span>)</span><br><span class="line">        <span class="comment"># choose the biggest value action</span></span><br><span class="line">        action = values[<span class="number">0</span>][<span class="number">1</span>]</span><br><span class="line">        action.append(self.symbol)</span><br><span class="line">        <span class="keyword">return</span> action</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># policy -&gt; self.estimations</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">save_policy</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">with</span> open(<span class="string">'policy_%s.bin'</span> % (<span class="string">'first'</span> <span class="keyword">if</span> self.symbol == <span class="number">1</span> <span class="keyword">else</span> <span class="string">'second'</span>), <span class="string">'wb'</span>) <span class="keyword">as</span> f:</span><br><span class="line">            pickle.dump(self.estimations, f)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">load_policy</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">with</span> open(<span class="string">'policy_%s.bin'</span> % (<span class="string">'first'</span> <span class="keyword">if</span> self.symbol == <span class="number">1</span> <span class="keyword">else</span> <span class="string">'second'</span>), <span class="string">'rb'</span>) <span class="keyword">as</span> f:</span><br><span class="line">            self.estimations = pickle.load(f)</span><br></pre></td></tr></table></figure>
<h3 id="这里需要注意一点就是，在backup方法里，只有greedy-action才会更新value，exploring虽然不会更新value，但是其随后的greedy-action会进行更新，个人的理解是：exploring并不能保证最优，它只是提供一种“探索”行为，帮助Learning-method更好的学习value，所以只对greedy-action进行update。这地方原文有解释："><a href="#这里需要注意一点就是，在backup方法里，只有greedy-action才会更新value，exploring虽然不会更新value，但是其随后的greedy-action会进行更新，个人的理解是：exploring并不能保证最优，它只是提供一种“探索”行为，帮助Learning-method更好的学习value，所以只对greedy-action进行update。这地方原文有解释：" class="headerlink" title="这里需要注意一点就是，在backup方法里，只有greedy-action才会更新value，exploring虽然不会更新value，但是其随后的greedy-action会进行更新，个人的理解是：exploring并不能保证最优，它只是提供一种“探索”行为，帮助Learning method更好的学习value，所以只对greedy-action进行update。这地方原文有解释："></a>这里需要注意一点就是，在backup方法里，只有greedy-action才会更新value，exploring虽然不会更新value，但是其随后的greedy-action会进行更新，个人的理解是：exploring并不能保证最优，它只是提供一种“探索”行为，帮助Learning method更好的学习value，所以只对greedy-action进行update。这地方原文有解释：</h3><p>Exploratory moves do not result in any learning, but each of our other moves does, causing updates as suggested by the curved arrow in which estimated values are moved up the tree from later nodes to earlier as detailed in the text.</p>
<h2 id="5、创建对决类Judger，通过一次对局完成一次value-table的update"><a href="#5、创建对决类Judger，通过一次对局完成一次value-table的update" class="headerlink" title="5、创建对决类Judger，通过一次对局完成一次value table的update"></a>5、创建对决类Judger，通过一次对局完成一次value table的update</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Judger</span>:</span></span><br><span class="line">    <span class="comment"># @player1: the player who will move first, its chessman will be 1</span></span><br><span class="line">    <span class="comment"># @player2: another player with a chessman -1</span></span><br><span class="line">    <span class="comment"># @feedback: if True, both players will receive rewards when game is end</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, player1, player2)</span>:</span></span><br><span class="line">        self.p1 = player1</span><br><span class="line">        self.p2 = player2</span><br><span class="line">        self.current_player = <span class="keyword">None</span></span><br><span class="line">        self.p1_symbol = <span class="number">1</span></span><br><span class="line">        self.p2_symbol = <span class="number">-1</span></span><br><span class="line">        self.p1.set_symbol(self.p1_symbol)</span><br><span class="line">        self.p2.set_symbol(self.p2_symbol)</span><br><span class="line">        self.current_state = State()</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">reset</span><span class="params">(self)</span>:</span></span><br><span class="line">        self.p1.reset()</span><br><span class="line">        self.p2.reset()</span><br><span class="line">        </span><br><span class="line">    <span class="comment"># return p1 and p2 in turn(alternately)</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">alternate</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">while</span> <span class="keyword">True</span>:</span><br><span class="line">            <span class="keyword">yield</span> self.p1</span><br><span class="line">            <span class="keyword">yield</span> self.p2</span><br><span class="line"></span><br><span class="line">    <span class="comment"># @print: if True, print each board during the game</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">play</span><span class="params">(self, print=False)</span>:</span></span><br><span class="line">        alternator = self.alternate()</span><br><span class="line">        self.reset()</span><br><span class="line">        current_state = State()</span><br><span class="line">        self.p1.set_state(current_state)</span><br><span class="line">        self.p2.set_state(current_state)</span><br><span class="line">        <span class="keyword">while</span> <span class="keyword">True</span>:</span><br><span class="line">            player = next(alternator)</span><br><span class="line">            <span class="keyword">if</span> <span class="keyword">print</span>:</span><br><span class="line">                current_state.print()</span><br><span class="line">            [i, j, symbol] = player.act()</span><br><span class="line">            next_state_hash = current_state.next_state(i, j, symbol).hash()</span><br><span class="line">            current_state, is_end = all_states[next_state_hash]</span><br><span class="line">            self.p1.set_state(current_state)</span><br><span class="line">            self.p2.set_state(current_state)</span><br><span class="line">            <span class="keyword">if</span> is_end:</span><br><span class="line">                <span class="keyword">if</span> <span class="keyword">print</span>:</span><br><span class="line">                    current_state.print()</span><br><span class="line">                <span class="keyword">return</span> current_state.winner</span><br></pre></td></tr></table></figure>
<h2 id="6、训练并让两名AI-Player进行对局"><a href="#6、训练并让两名AI-Player进行对局" class="headerlink" title="6、训练并让两名AI Player进行对局"></a>6、训练并让两名AI Player进行对局</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">train</span><span class="params">(epochs)</span>:</span></span><br><span class="line">    player1 = Player(epsilon=<span class="number">0.01</span>)</span><br><span class="line">    player2 = Player(epsilon=<span class="number">0.01</span>)</span><br><span class="line">    judger = Judger(player1, player2)</span><br><span class="line">    player1_win = <span class="number">0.0</span></span><br><span class="line">    player2_win = <span class="number">0.0</span></span><br><span class="line">    player1_a = []</span><br><span class="line">    player2_a = []</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">1</span>, epochs + <span class="number">1</span>):</span><br><span class="line">        winner = judger.play(<span class="keyword">print</span>=<span class="keyword">False</span>)</span><br><span class="line">        <span class="keyword">if</span> winner == <span class="number">1</span>:</span><br><span class="line">            player1_win += <span class="number">1</span></span><br><span class="line">        <span class="keyword">if</span> winner == <span class="number">-1</span>:</span><br><span class="line">            player2_win += <span class="number">1</span></span><br><span class="line">        player1_a.append(player1_win/i)</span><br><span class="line">        player2_a.append(player2_win/i)</span><br><span class="line">        <span class="comment">#print('Epoch %d, player 1 win %.02f, player 2 win %.02f' % (i, player1_win / i, player2_win / i))</span></span><br><span class="line">        player1.backup()</span><br><span class="line">        player2.backup()</span><br><span class="line">        judger.reset()</span><br><span class="line">    player1.save_policy()</span><br><span class="line">    player2.save_policy()</span><br><span class="line">    x = range(<span class="number">1</span>,<span class="number">1001</span>,<span class="number">1</span>)</span><br><span class="line">    x = list(x)</span><br><span class="line">    plt.plot(x,player1_a)</span><br><span class="line">    plt.plot(x,player2_a)</span><br><span class="line">    plt.axis([<span class="number">0</span>,<span class="number">200</span>,<span class="number">0</span>,<span class="number">1</span>])</span><br><span class="line">    plt.title(<span class="string">'training chart'</span>)</span><br><span class="line">    plt.show()</span><br><span class="line">    </span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">compete</span><span class="params">(turns)</span>:</span></span><br><span class="line">    player1 = Player(epsilon=<span class="number">0</span>)</span><br><span class="line">    player2 = Player(epsilon=<span class="number">0</span>)</span><br><span class="line">    judger = Judger(player1, player2)</span><br><span class="line">    player1.load_policy()</span><br><span class="line">    player2.load_policy()</span><br><span class="line">    player1_win = <span class="number">0.0</span></span><br><span class="line">    player2_win = <span class="number">0.0</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">0</span>, turns):</span><br><span class="line">        winner = judger.play()</span><br><span class="line">        <span class="keyword">if</span> winner == <span class="number">1</span>:</span><br><span class="line">            player1_win += <span class="number">1</span></span><br><span class="line">        <span class="keyword">if</span> winner == <span class="number">-1</span>:</span><br><span class="line">            player2_win += <span class="number">1</span></span><br><span class="line">        judger.reset()</span><br><span class="line">    print(<span class="string">'%d turns, player 1 win %.02f, player 2 win %.02f'</span> % (turns, player1_win / turns, player2_win / turns))</span><br><span class="line"></span><br><span class="line">train(int(<span class="number">1e3</span>))</span><br></pre></td></tr></table></figure>
<p><img src="https://wx3.sinaimg.cn/large/0070VybLly1fx7to20tg5j30al07c3yo.jpg" alt="png"></p>

      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      
        <div class="post-tags">
          
            <a href="/tags/Reinforcement-Learning-Jupyter-Notebook/" rel="tag"># Reinforcement Learning Jupyter Notebook</a>
          
        </div>
      

      
      
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/2018/11/12/Chapter01-Introduction/" rel="next" title="Chapter01 Introduction">
                <i class="fa fa-chevron-left"></i> Chapter01 Introduction
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/2018/11/14/Chapter02-Multi-armed-Bandits/" rel="prev" title="Chapter02 Multi-armed Bandits">
                Chapter02 Multi-armed Bandits <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </div>
  
  
  
  </article>



    <div class="post-spread">
      
    </div>
  </div>


          </div>
          


          

  



        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap">
            Table of Contents
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview-wrap">
            Overview
          </li>
        </ul>
      

      <section class="site-overview-wrap sidebar-panel">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope="" itemtype="http://schema.org/Person">
            
              <img class="site-author-image" itemprop="image" src="https://wx2.sinaimg.cn/large/0070VybLly1fxoqylcs4uj309708rgoa.jpg" alt="xingE650">
            
              <p class="site-author-name" itemprop="name">xingE650</p>
              <p class="site-description motion-element" itemprop="description"></p>
          </div>

          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
                <a href="/archives/">
              
                  <span class="site-state-item-count">33</span>
                  <span class="site-state-item-name">posts</span>
                </a>
              </div>
            

            

            
              
              
              <div class="site-state-item site-state-tags">
                <a href="/tags/index.html">
                  <span class="site-state-item-count">3</span>
                  <span class="site-state-item-name">tags</span>
                </a>
              </div>
            

          </nav>

          

          

          
          

          
          
            <div class="links-of-blogroll motion-element links-of-blogroll-inline">
              <div class="links-of-blogroll-title">
                <i class="fa  fa-fw fa-link"></i>
                Helpful Link
              </div>
              <ul class="links-of-blogroll-list">
                
                  <li class="links-of-blogroll-item">
                    <a href="https://docs.scipy.org/doc/numpy/reference/index.html" title="numpy-reference" target="_blank">numpy-reference</a>
                  </li>
                
                  <li class="links-of-blogroll-item">
                    <a href="https://github.com/ShangtongZhang/reinforcement-learning-an-introduction" title="RL-book-code" target="_blank">RL-book-code</a>
                  </li>
                
              </ul>
            </div>
          

          

        </div>
      </section>

      
      <!--noindex-->
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">

            
              
            

            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#1、引入模块并定义井字棋的常量"><span class="nav-number">1.</span> <span class="nav-text">1、引入模块并定义井字棋的常量</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#2、创建环境，State类，表征棋盘上的X和O子的情况。"><span class="nav-number">2.</span> <span class="nav-text">2、创建环境，State类，表征棋盘上的X和O子的情况。</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#关于这里的hash函数，是为了得到不重复的所有棋盘情况。但是为什么可以通过这种算法那？"><span class="nav-number">2.1.</span> <span class="nav-text">关于这里的hash函数，是为了得到不重复的所有棋盘情况。但是为什么可以通过这种算法那？</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#假设两个不同的棋盘情况A和B，他们的hash值是一致的，我们不妨设他们的最高位不相同，那么我们看到，该位最少相差1，通过等比数列求和可以得到，3-n-1-gt-2-1-3-1-3-2-…-3-n-，即最高位不同是无法通过其余位来弥补的，那么可见他们的最高位不同是不可能hash值相同的，以此递推，则可得A和B值是一样，即一样的棋盘，假设不成立。"><span class="nav-number">2.1.1.</span> <span class="nav-text">假设两个不同的棋盘情况A和B，他们的hash值是一致的，我们不妨设他们的最高位不相同，那么我们看到，该位最少相差1，通过等比数列求和可以得到，3^(n+1)&gt;2*(1+3^1+3^2+…+3^n)，即最高位不同是无法通过其余位来弥补的，那么可见他们的最高位不同是不可能hash值相同的，以此递推，则可得A和B值是一样，即一样的棋盘，假设不成立。</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#3、公共函数，用来获取当前state。"><span class="nav-number">3.</span> <span class="nav-text">3、公共函数，用来获取当前state。</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#4、Player类，用来模拟AI选手下棋的行为，得到value-function"><span class="nav-number">4.</span> <span class="nav-text">4、Player类，用来模拟AI选手下棋的行为，得到value function</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#这里需要注意一点就是，在backup方法里，只有greedy-action才会更新value，exploring虽然不会更新value，但是其随后的greedy-action会进行更新，个人的理解是：exploring并不能保证最优，它只是提供一种“探索”行为，帮助Learning-method更好的学习value，所以只对greedy-action进行update。这地方原文有解释："><span class="nav-number">4.1.</span> <span class="nav-text">这里需要注意一点就是，在backup方法里，只有greedy-action才会更新value，exploring虽然不会更新value，但是其随后的greedy-action会进行更新，个人的理解是：exploring并不能保证最优，它只是提供一种“探索”行为，帮助Learning method更好的学习value，所以只对greedy-action进行update。这地方原文有解释：</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#5、创建对决类Judger，通过一次对局完成一次value-table的update"><span class="nav-number">5.</span> <span class="nav-text">5、创建对决类Judger，通过一次对局完成一次value table的update</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#6、训练并让两名AI-Player进行对局"><span class="nav-number">6.</span> <span class="nav-text">6、训练并让两名AI Player进行对局</span></a></li></ol></div>
            

          </div>
        </section>
      <!--/noindex-->
      

      
        <div class="back-to-top">
          <i class="fa fa-arrow-up"></i>
          
        </div>
      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2018</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">xingE650</span>

  
</div>


  <div class="powered-by">Powered by <a class="theme-link" target="_blank" href="https://hexo.io">Hexo</a></div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">Theme &mdash; <a class="theme-link" target="_blank" href="https://github.com/iissnan/hexo-theme-next">NexT.Gemini</a> v5.1.4</div>




        







        
      </div>
    </footer>

    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>
  

  
  
    <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.4"></script>



  
  


  <script type="text/javascript" src="/js/src/affix.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/schemes/pisces.js?v=5.1.4"></script>



  
  <script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.4"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.1.4"></script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.4"></script>



  


  




	





  





  












  

  <script type="text/javascript">
    // Popup Window;
    var isfetched = false;
    var isXml = true;
    // Search DB path;
    var search_path = "search.xml";
    if (search_path.length === 0) {
      search_path = "search.xml";
    } else if (/json$/i.test(search_path)) {
      isXml = false;
    }
    var path = "/" + search_path;
    // monitor main search box;

    var onPopupClose = function (e) {
      $('.popup').hide();
      $('#local-search-input').val('');
      $('.search-result-list').remove();
      $('#no-result').remove();
      $(".local-search-pop-overlay").remove();
      $('body').css('overflow', '');
    }

    function proceedsearch() {
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay"></div>')
        .css('overflow', 'hidden');
      $('.search-popup-overlay').click(onPopupClose);
      $('.popup').toggle();
      var $localSearchInput = $('#local-search-input');
      $localSearchInput.attr("autocapitalize", "none");
      $localSearchInput.attr("autocorrect", "off");
      $localSearchInput.focus();
    }

    // search function;
    var searchFunc = function(path, search_id, content_id) {
      'use strict';

      // start loading animation
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay">' +
          '<div id="search-loading-icon">' +
          '<i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>' +
          '</div>' +
          '</div>')
        .css('overflow', 'hidden');
      $("#search-loading-icon").css('margin', '20% auto 0 auto').css('text-align', 'center');

      $.ajax({
        url: path,
        dataType: isXml ? "xml" : "json",
        async: true,
        success: function(res) {
          // get the contents from search data
          isfetched = true;
          $('.popup').detach().appendTo('.header-inner');
          var datas = isXml ? $("entry", res).map(function() {
            return {
              title: $("title", this).text(),
              content: $("content",this).text(),
              url: $("url" , this).text()
            };
          }).get() : res;
          var input = document.getElementById(search_id);
          var resultContent = document.getElementById(content_id);
          var inputEventFunction = function() {
            var searchText = input.value.trim().toLowerCase();
            var keywords = searchText.split(/[\s\-]+/);
            if (keywords.length > 1) {
              keywords.push(searchText);
            }
            var resultItems = [];
            if (searchText.length > 0) {
              // perform local searching
              datas.forEach(function(data) {
                var isMatch = false;
                var hitCount = 0;
                var searchTextCount = 0;
                var title = data.title.trim();
                var titleInLowerCase = title.toLowerCase();
                var content = data.content.trim().replace(/<[^>]+>/g,"");
                var contentInLowerCase = content.toLowerCase();
                var articleUrl = decodeURIComponent(data.url);
                var indexOfTitle = [];
                var indexOfContent = [];
                // only match articles with not empty titles
                if(title != '') {
                  keywords.forEach(function(keyword) {
                    function getIndexByWord(word, text, caseSensitive) {
                      var wordLen = word.length;
                      if (wordLen === 0) {
                        return [];
                      }
                      var startPosition = 0, position = [], index = [];
                      if (!caseSensitive) {
                        text = text.toLowerCase();
                        word = word.toLowerCase();
                      }
                      while ((position = text.indexOf(word, startPosition)) > -1) {
                        index.push({position: position, word: word});
                        startPosition = position + wordLen;
                      }
                      return index;
                    }

                    indexOfTitle = indexOfTitle.concat(getIndexByWord(keyword, titleInLowerCase, false));
                    indexOfContent = indexOfContent.concat(getIndexByWord(keyword, contentInLowerCase, false));
                  });
                  if (indexOfTitle.length > 0 || indexOfContent.length > 0) {
                    isMatch = true;
                    hitCount = indexOfTitle.length + indexOfContent.length;
                  }
                }

                // show search results

                if (isMatch) {
                  // sort index by position of keyword

                  [indexOfTitle, indexOfContent].forEach(function (index) {
                    index.sort(function (itemLeft, itemRight) {
                      if (itemRight.position !== itemLeft.position) {
                        return itemRight.position - itemLeft.position;
                      } else {
                        return itemLeft.word.length - itemRight.word.length;
                      }
                    });
                  });

                  // merge hits into slices

                  function mergeIntoSlice(text, start, end, index) {
                    var item = index[index.length - 1];
                    var position = item.position;
                    var word = item.word;
                    var hits = [];
                    var searchTextCountInSlice = 0;
                    while (position + word.length <= end && index.length != 0) {
                      if (word === searchText) {
                        searchTextCountInSlice++;
                      }
                      hits.push({position: position, length: word.length});
                      var wordEnd = position + word.length;

                      // move to next position of hit

                      index.pop();
                      while (index.length != 0) {
                        item = index[index.length - 1];
                        position = item.position;
                        word = item.word;
                        if (wordEnd > position) {
                          index.pop();
                        } else {
                          break;
                        }
                      }
                    }
                    searchTextCount += searchTextCountInSlice;
                    return {
                      hits: hits,
                      start: start,
                      end: end,
                      searchTextCount: searchTextCountInSlice
                    };
                  }

                  var slicesOfTitle = [];
                  if (indexOfTitle.length != 0) {
                    slicesOfTitle.push(mergeIntoSlice(title, 0, title.length, indexOfTitle));
                  }

                  var slicesOfContent = [];
                  while (indexOfContent.length != 0) {
                    var item = indexOfContent[indexOfContent.length - 1];
                    var position = item.position;
                    var word = item.word;
                    // cut out 100 characters
                    var start = position - 20;
                    var end = position + 80;
                    if(start < 0){
                      start = 0;
                    }
                    if (end < position + word.length) {
                      end = position + word.length;
                    }
                    if(end > content.length){
                      end = content.length;
                    }
                    slicesOfContent.push(mergeIntoSlice(content, start, end, indexOfContent));
                  }

                  // sort slices in content by search text's count and hits' count

                  slicesOfContent.sort(function (sliceLeft, sliceRight) {
                    if (sliceLeft.searchTextCount !== sliceRight.searchTextCount) {
                      return sliceRight.searchTextCount - sliceLeft.searchTextCount;
                    } else if (sliceLeft.hits.length !== sliceRight.hits.length) {
                      return sliceRight.hits.length - sliceLeft.hits.length;
                    } else {
                      return sliceLeft.start - sliceRight.start;
                    }
                  });

                  // select top N slices in content

                  var upperBound = parseInt('1');
                  if (upperBound >= 0) {
                    slicesOfContent = slicesOfContent.slice(0, upperBound);
                  }

                  // highlight title and content

                  function highlightKeyword(text, slice) {
                    var result = '';
                    var prevEnd = slice.start;
                    slice.hits.forEach(function (hit) {
                      result += text.substring(prevEnd, hit.position);
                      var end = hit.position + hit.length;
                      result += '<b class="search-keyword">' + text.substring(hit.position, end) + '</b>';
                      prevEnd = end;
                    });
                    result += text.substring(prevEnd, slice.end);
                    return result;
                  }

                  var resultItem = '';

                  if (slicesOfTitle.length != 0) {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + highlightKeyword(title, slicesOfTitle[0]) + "</a>";
                  } else {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + title + "</a>";
                  }

                  slicesOfContent.forEach(function (slice) {
                    resultItem += "<a href='" + articleUrl + "'>" +
                      "<p class=\"search-result\">" + highlightKeyword(content, slice) +
                      "...</p>" + "</a>";
                  });

                  resultItem += "</li>";
                  resultItems.push({
                    item: resultItem,
                    searchTextCount: searchTextCount,
                    hitCount: hitCount,
                    id: resultItems.length
                  });
                }
              })
            };
            if (keywords.length === 1 && keywords[0] === "") {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-search fa-5x" /></div>'
            } else if (resultItems.length === 0) {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-frown-o fa-5x" /></div>'
            } else {
              resultItems.sort(function (resultLeft, resultRight) {
                if (resultLeft.searchTextCount !== resultRight.searchTextCount) {
                  return resultRight.searchTextCount - resultLeft.searchTextCount;
                } else if (resultLeft.hitCount !== resultRight.hitCount) {
                  return resultRight.hitCount - resultLeft.hitCount;
                } else {
                  return resultRight.id - resultLeft.id;
                }
              });
              var searchResultList = '<ul class=\"search-result-list\">';
              resultItems.forEach(function (result) {
                searchResultList += result.item;
              })
              searchResultList += "</ul>";
              resultContent.innerHTML = searchResultList;
            }
          }

          if ('auto' === 'auto') {
            input.addEventListener('input', inputEventFunction);
          } else {
            $('.search-icon').click(inputEventFunction);
            input.addEventListener('keypress', function (event) {
              if (event.keyCode === 13) {
                inputEventFunction();
              }
            });
          }

          // remove loading animation
          $(".local-search-pop-overlay").remove();
          $('body').css('overflow', '');

          proceedsearch();
        }
      });
    }

    // handle and trigger popup window;
    $('.popup-trigger').click(function(e) {
      e.stopPropagation();
      if (isfetched === false) {
        searchFunc(path, 'local-search-input', 'local-search-result');
      } else {
        proceedsearch();
      };
    });

    $('.popup-btn-close').click(onPopupClose);
    $('.popup').click(function(e){
      e.stopPropagation();
    });
    $(document).on('keyup', function (event) {
      var shouldDismissSearchPopup = event.which === 27 &&
        $('.search-popup').is(':visible');
      if (shouldDismissSearchPopup) {
        onPopupClose();
      }
    });
  </script>





  

  

  

  
  

  

  

  

  <ul class="cb-slideshow">
		<li>
		<span>1</span></li>
		<li>
		<span>2</span></li>
		<li>
		<span>3</span></li>
		<li>
		<span>4</span></li>
		<li>
		<span>5</span></li>
		<li>
		<span>6</span></li>
  </ul>

<body oncopy="alert('be helpful to you(๑•̀ㅂ•́)و✧');return true;">
</body>
</body></html>
